# How to write a test for the clang-tidy aspect

Basically, there are two ways of testing the `tidy_aspect`. One would be to use it together with the [default](../../../BUILD#L17) *quality_clang_tidy_config* and the other one would be to provide such config explicitly. However, both ways require similar handling in the [BUILD](./BUILD) file of this folder.

For adding a new test, always start with declaring a new [`tidy_suite_test`](tidy_suite_validation.bzl#L53) for which two mandatory pieces of information must be provided. These are the expected result of the test (particular clang-tidy findings vs. no clang-tidy findings) as well as a build target which will trigger a `tidy_aspect` to visit another build target and perform the clang-tidy checks.

To declare a build target which triggers a `tidy_aspect` visiting another build target, one can either use the predefined [`tidy_suite`](../tidy_suite.bzl#L95) rule which will make use of the [default](../tidy_aspect.bzl#L282) `tidy_aspect` (cf. [here](../tidy_suite.bzl#L88)) and which does **not** offer to provide any custom `quality_clang_tidy_config`. To acheive the latter nonetheless, see the next section. A [`tidy_suite`](../tidy_suite.bzl#L95) rule requires a list of the clang-tidy checks to be performed as well as the name of the C/C++ build target to be checked in its *deps* attribute. This is the attribute which acts as root entry point for the [default](../tidy_aspect.bzl#L282) `tidy_aspect` to start its visitation logic. Note: The therein referenced build target must not be additionally referenced by any other `tidy_suite` since name clashes might occur in that case for the findings output files produced by clang-tidy.

In case the functionality of the [default](../tidy_aspect.bzl#L282) `tidy_aspect` is not sufficient and a custom `quality_clang_tidy_config` is required, one could also provide a definition for a custom `tidy_suite` and use that one in conjunction with a [`tidy_suite_test`](tidy_suite_validation.bzl#L53). The file [custom_tidy_suites.bzl](./custom_tidy_suites.bzl) contains plenty of examples how to perform that. Note that each individual `quality_clang_tidy_config` requires a corresponding `tidy_aspect` to be instantiated individually in such *.bzl* file since bazel requires aspects to be defined statically. The definition of the `quality_clang_tidy_config` itself can done in this directory's [BUILD](./BUILD) file.
